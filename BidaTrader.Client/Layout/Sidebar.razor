@inject IAuthService AuthService
@inject NavigationManager NavigationManager

@* <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

        <AuthorizeView Roles="Admin">
            <Authorized>

                <li class="nav-heading">Quản trị hệ thống</li>

                <li class="nav-item">
                    <NavLink class="nav-link" href="/admin/dashboard">
                        <i class="bi bi-speedometer2"></i><span>Dashboard</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <a class="nav-link collapsed" data-bs-target="#admin-manage" data-bs-toggle="collapse">
                        <i class="bi bi-gear"></i><span>Quản lý hệ thống</span><i class="bi bi-chevron-down ms-auto"></i>
                    </a>
                    <ul id="admin-manage" class="nav-content collapse">
                        <li>
                            <NavLink href="/admin/users"><i class="bi bi-circle"></i><span>Người dùng</span></NavLink>
                        </li>
                        <li>
                            <NavLink href="/admin/store"><i class="bi bi-circle"></i><span>Cửa hàng</span></NavLink>
                        </li>
                        <li>
                            <NavLink href="/admin/logs"><i class="bi bi-circle"></i><span>Nhật ký hệ thống</span></NavLink>
                        </li>
                        <li>
                            <NavLink href="/admin/settings"><i class="bi bi-circle"></i><span>Cấu hình</span></NavLink>
                        </li>
                    </ul>
                </li>

                <li class="nav-item">
                    <button class="nav-link collapsed w-100 text-start border-0 bg-transparent" @onclick="HandleLogout">
                        <i class="bi bi-box-arrow-right"></i><span>Đăng xuất</span>
                    </button>
                </li>

            </Authorized>
        </AuthorizeView>


        <AuthorizeView Roles="Store">
            <Authorized>

                <li class="nav-heading mt-3">Quản lý cửa hàng</li>

                <li class="nav-item">
                    <NavLink class="nav-link" href="/store/dashboard">
                        <i class="bi bi-shop"></i><span>Dashboard cửa hàng</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <a class="nav-link collapsed" data-bs-target="#store-manage" data-bs-toggle="collapse">
                        <i class="bi bi-box-seam"></i><span>Sản phẩm</span><i class="bi bi-chevron-down ms-auto"></i>
                    </a>
                    <ul id="store-manage" class="nav-content collapse">
                        <li><NavLink href="/store/products"><i class="bi bi-circle"></i><span>Danh sách</span></NavLink></li>
                        <li><NavLink href="/store/product/add"><i class="bi bi-circle"></i><span>Thêm mới</span></NavLink></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <NavLink class="nav-link collapsed" href="/store/orders">
                        <i class="bi bi-cart-check"></i><span>Đơn hàng</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <NavLink class="nav-link collapsed" href="/store/statistics">
                        <i class="bi bi-bar-chart"></i><span>Thống kê</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <button class="nav-link collapsed w-100 text-start border-0 bg-transparent" @onclick="HandleLogout">
                        <i class="bi bi-box-arrow-right"></i><span>Đăng xuất</span>
                    </button>
                </li>

            </Authorized>
        </AuthorizeView>

        <AuthorizeView Roles="Customer">
            <Authorized>

                <li class="nav-heading mt-3">Tài khoản của tôi</li>

                <li class="nav-item">
                    <NavLink class="nav-link collapsed" href="/profile">
                        <i class="bi bi-person-circle"></i><span>Hồ sơ cá nhân</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <NavLink class="nav-link collapsed" href="/my-orders">
                        <i class="bi bi-bag-check"></i><span>Đơn hàng</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <NavLink class="nav-link collapsed" href="/wishlist">
                        <i class="bi bi-heart"></i><span>Yêu thích</span>
                    </NavLink>
                </li>

                <li class="nav-item">
                    <button class="nav-link collapsed w-100 text-start border-0 bg-transparent" @onclick="HandleLogout">
                        <i class="bi bi-box-arrow-right"></i><span>Đăng xuất</span>
                    </button>
                </li>

            </Authorized>
        </AuthorizeView>

        <li class="nav-heading">Cửa Hàng</li>

        <li class="nav-item">
            <NavLink class="nav-link collapsed" href="/" Match="NavLinkMatch.All">
                <i class="bi bi-shop"></i>
                <span>Trang chủ</span>
            </NavLink>
        </li>

        <li class="nav-item nav-item-flyout">
            <a class="nav-link collapsed" href="Products" style="cursor: pointer;">
                <i class="bi bi-menu-button-wide"></i>
                <span>Danh Mục Sản Phẩm</span>
                <i class="bi bi-chevron-right ms-auto" style="font-size: 0.8em;"></i>
            </a>

            <ul class="flyout-menu">
                <li class="flyout-header">Chọn loại sản phẩm</li>
                @if (categories != null && categories.Any())
                {
                    @foreach (var cat in categories)
                    {
                        <li>
                            <a href="@($"products?categoryId={cat.Id}")">@cat.Name</a>
                        </li>
                    }
                }
                else
                {
                    <li><a href="#">@(categories == null ? "Đang tải..." : "Chưa có danh mục")</a></li>
                }
            </ul>
        </li>

        <li class="nav-item nav-item-flyout">
            <a class="nav-link collapsed" href="Products" style="cursor: pointer;">
                <i class="bi bi-tags"></i>
                <span>Thương Hiệu</span>
                <i class="bi bi-chevron-right ms-auto" style="font-size: 0.8em;"></i>
            </a>

            <ul class="flyout-menu">
                <li class="flyout-header">Chọn nhà cung cấp</li>
                @if (brands != null && brands.Any())
                {
                    @foreach (var brand in brands)
                    {
                        <li>
                            <a href="@($"products?brandId={brand.Id}")">@brand.Name</a>
                        </li>
                    }
                }
                else
                {
                    <li><a href="#">@(brands == null ? "Đang tải..." : "Chưa có thương hiệu")</a></li>
                }
            </ul>
        </li>

        <li class="nav-item">
            <NavLink class="nav-link collapsed" href="posts">
                <i class="bi bi-newspaper"></i>
                <span>Tin tức & Cộng đồng</span>
            </NavLink>
        </li>
    </ul>

</aside> *@


@code {
    private bool isVisibleLogin { get; set; } = false;
    private bool isVisibleRegister { get; set; } = false;

    private List<Category>? categories;
    private List<Brand>? brands;

    protected override async Task OnInitializedAsync()
    {
        await LoadMenuData();
    }

    private async Task LoadMenuData()
    {
        try
        {

        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading menu: {ex.Message}");
        }
    }

    private void ShowLoginForm()
    {
        isVisibleLogin = true;
    }

    private void ShowRegisterForm()
    {
        isVisibleRegister = true;
    }

    private async Task HandleLogout()
    {
        await AuthService.Logout();
        NavigationManager.NavigateTo("/login", true);
    }
}

<aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
    <div class="app-brand demo">
        <a href="" class="app-brand-link">
            <img src="../assets/img/logo.png" alt="Logo" width="50" class="app-brand-logo demo" />
            <span class="app-brand-text demo menu-text fw-bolder ms-2">BidaTrader</span>
        </a>

        <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
            <i class="bx bx-chevron-left bx-sm align-middle"></i>
        </a>
    </div>

    <div class="menu-inner-shadow"></div>

    <ul class="menu-inner py-1">
        <!-- Dashboard -->
        <li class="menu-item active">
            <a href="index.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Trang chủ</div>
            </a>
        </li>

        <!-- Layouts -->
        <AuthorizeView Roles="Admin">
            <Authorized>
                <li class="menu-item">
                    <a href="javascript:void(0);" class="menu-link menu-toggle">
                        <i class="menu-icon tf-icons bx bx-layout"></i>
                        <div data-i18n="Layouts">Trang quản trị</div>
                    </a>

                    <ul class="menu-sub">
                        <li class="menu-item">
                            <a href="layouts-without-menu.html" class="menu-link">
                                <div data-i18n="Without menu">Người dùng</div>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="layouts-without-navbar.html" class="menu-link">
                                <div data-i18n="Without navbar">Cửa hàng</div>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="layouts-container.html" class="menu-link">
                                <div data-i18n="Container">Sản phẩm</div>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="layouts-fluid.html" class="menu-link">
                                <div data-i18n="Fluid">Bài viết</div>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="layouts-blank.html" class="menu-link">
                                <div data-i18n="Blank">Phản hồi</div>
                            </a>
                        </li>
                    </ul>
                </li>
            </Authorized>
        </AuthorizeView>

        <li class="menu-header small text-uppercase">
            <span class="menu-header-text">Pages</span>
        </li>
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-dock-top"></i>
                <div data-i18n="Account Settings">Account Settings</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="pages-account-settings-account.html" class="menu-link">
                        <div data-i18n="Account">Account</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="pages-account-settings-notifications.html" class="menu-link">
                        <div data-i18n="Notifications">Notifications</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="pages-account-settings-connections.html" class="menu-link">
                        <div data-i18n="Connections">Connections</div>
                    </a>
                </li>
            </ul>
        </li>
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-lock-open-alt"></i>
                <div data-i18n="Authentications">Authentications</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="auth-login-basic.html" class="menu-link" target="_blank">
                        <div data-i18n="Basic">Login</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="auth-register-basic.html" class="menu-link" target="_blank">
                        <div data-i18n="Basic">Register</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="auth-forgot-password-basic.html" class="menu-link" target="_blank">
                        <div data-i18n="Basic">Forgot Password</div>
                    </a>
                </li>
            </ul>
        </li>
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-cube-alt"></i>
                <div data-i18n="Misc">Misc</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="pages-misc-error.html" class="menu-link">
                        <div data-i18n="Error">Error</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="pages-misc-under-maintenance.html" class="menu-link">
                        <div data-i18n="Under Maintenance">Under Maintenance</div>
                    </a>
                </li>
            </ul>
        </li>
        <!-- Components -->
        <li class="menu-header small text-uppercase"><span class="menu-header-text">Components</span></li>
        <!-- Cards -->
        <li class="menu-item">
            <a href="cards-basic.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-collection"></i>
                <div data-i18n="Basic">Cards</div>
            </a>
        </li>
        <!-- User interface -->
        <li class="menu-item">
            <a href="javascript:void(0)" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-box"></i>
                <div data-i18n="User interface">User interface</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="ui-accordion.html" class="menu-link">
                        <div data-i18n="Accordion">Accordion</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-alerts.html" class="menu-link">
                        <div data-i18n="Alerts">Alerts</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-badges.html" class="menu-link">
                        <div data-i18n="Badges">Badges</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-buttons.html" class="menu-link">
                        <div data-i18n="Buttons">Buttons</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-carousel.html" class="menu-link">
                        <div data-i18n="Carousel">Carousel</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-collapse.html" class="menu-link">
                        <div data-i18n="Collapse">Collapse</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-dropdowns.html" class="menu-link">
                        <div data-i18n="Dropdowns">Dropdowns</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-footer.html" class="menu-link">
                        <div data-i18n="Footer">Footer</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-list-groups.html" class="menu-link">
                        <div data-i18n="List Groups">List groups</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-modals.html" class="menu-link">
                        <div data-i18n="Modals">Modals</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-navbar.html" class="menu-link">
                        <div data-i18n="Navbar">Navbar</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-offcanvas.html" class="menu-link">
                        <div data-i18n="Offcanvas">Offcanvas</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-pagination-breadcrumbs.html" class="menu-link">
                        <div data-i18n="Pagination &amp; Breadcrumbs">Pagination &amp; Breadcrumbs</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-progress.html" class="menu-link">
                        <div data-i18n="Progress">Progress</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-spinners.html" class="menu-link">
                        <div data-i18n="Spinners">Spinners</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-tabs-pills.html" class="menu-link">
                        <div data-i18n="Tabs &amp; Pills">Tabs &amp; Pills</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-toasts.html" class="menu-link">
                        <div data-i18n="Toasts">Toasts</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-tooltips-popovers.html" class="menu-link">
                        <div data-i18n="Tooltips & Popovers">Tooltips &amp; popovers</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="ui-typography.html" class="menu-link">
                        <div data-i18n="Typography">Typography</div>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Extended components -->
        <li class="menu-item">
            <a href="javascript:void(0)" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-copy"></i>
                <div data-i18n="Extended UI">Extended UI</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="extended-ui-perfect-scrollbar.html" class="menu-link">
                        <div data-i18n="Perfect Scrollbar">Perfect scrollbar</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="extended-ui-text-divider.html" class="menu-link">
                        <div data-i18n="Text Divider">Text Divider</div>
                    </a>
                </li>
            </ul>
        </li>

        <li class="menu-item">
            <a href="icons-boxicons.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-crown"></i>
                <div data-i18n="Boxicons">Boxicons</div>
            </a>
        </li>

        <!-- Forms & Tables -->
        <li class="menu-header small text-uppercase"><span class="menu-header-text">Forms &amp; Tables</span></li>
        <!-- Forms -->
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-detail"></i>
                <div data-i18n="Form Elements">Form Elements</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="forms-basic-inputs.html" class="menu-link">
                        <div data-i18n="Basic Inputs">Basic Inputs</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="forms-input-groups.html" class="menu-link">
                        <div data-i18n="Input groups">Input groups</div>
                    </a>
                </li>
            </ul>
        </li>
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-detail"></i>
                <div data-i18n="Form Layouts">Form Layouts</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="form-layouts-vertical.html" class="menu-link">
                        <div data-i18n="Vertical Form">Vertical Form</div>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="form-layouts-horizontal.html" class="menu-link">
                        <div data-i18n="Horizontal Form">Horizontal Form</div>
                    </a>
                </li>
            </ul>
        </li>
        <!-- Tables -->
        <li class="menu-item">
            <a href="tables-basic.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-table"></i>
                <div data-i18n="Tables">Tables</div>
            </a>
        </li>
        <!-- Misc -->
        <li class="menu-header small text-uppercase"><span class="menu-header-text">Misc</span></li>
        <li class="menu-item">
            <a href="https://github.com/themeselection/sneat-html-admin-template-free/issues"
               target="_blank"
               class="menu-link">
                <i class="menu-icon tf-icons bx bx-support"></i>
                <div data-i18n="Support">Support</div>
            </a>
        </li>
        <li class="menu-item">
            <a href="https://themeselection.com/demo/sneat-bootstrap-html-admin-template/documentation/"
               target="_blank"
               class="menu-link">
                <i class="menu-icon tf-icons bx bx-file"></i>
                <div data-i18n="Documentation">Documentation</div>
            </a>
        </li>
    </ul>
</aside>